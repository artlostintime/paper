<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel | Portfolio</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öôÔ∏è</text></svg>"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lora:ital,wght@0,400;0,600;1,400&family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <!-- KaTeX for preview -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
    ></script>

    <!-- Marked.js for preview -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
      :root {
        --bg-body: #1c1b1a;
        --bg-card: #252422;
        --bg-input: #1a1918;
        --text-main: #e8e4df;
        --text-muted: #9a9590;
        --text-light: #b8b2aa;
        --accent: #c9785d;
        --accent-hover: #e08b6d;
        --line: #3a3836;
        --line-light: #2d2b29;
        --success: #7fa86f;
        --danger: #c75d5d;
        --warning: #d4a855;
        --info: #5d9dc9;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background: var(--bg-body);
        color: var(--text-main);
        font-family: "Inter", sans-serif;
        line-height: 1.6;
        min-height: 100vh;
      }

      /* Header */
      .admin-header {
        background: var(--bg-card);
        border-bottom: 1px solid var(--line);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .admin-header h1 {
        font-size: 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .admin-header h1 i {
        color: var(--accent);
      }

      .header-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      /* Search in header */
      .header-search {
        position: relative;
      }

      .header-search input {
        background: var(--bg-input);
        border: 1px solid var(--line);
        border-radius: 20px;
        padding: 8px 16px 8px 36px;
        color: var(--text-main);
        font-size: 0.85rem;
        width: 200px;
        transition: all 0.3s;
      }

      .header-search input:focus {
        outline: none;
        border-color: var(--accent);
        width: 250px;
      }

      .header-search i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        font-size: 0.85rem;
      }

      .btn {
        font-family: inherit;
        font-size: 0.9rem;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
        border: 1px solid transparent;
        text-decoration: none;
      }

      .btn-primary {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .btn-primary:hover {
        background: var(--accent-hover);
        border-color: var(--accent-hover);
      }

      .btn-secondary {
        background: var(--bg-card);
        color: var(--text-main);
        border-color: var(--line);
      }

      .btn-secondary:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .btn-danger {
        background: transparent;
        color: var(--danger);
        border-color: var(--danger);
      }

      .btn-danger:hover {
        background: var(--danger);
        color: white;
      }

      .btn-icon {
        padding: 8px;
        border-radius: 6px;
        background: transparent;
        border: 1px solid var(--line);
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-icon:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      /* Main Layout */
      .admin-container {
        display: grid;
        grid-template-columns: 280px 1fr;
        min-height: calc(100vh - 60px);
      }

      /* Sidebar - Paper List */
      .sidebar {
        background: var(--bg-card);
        border-right: 1px solid var(--line);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .sidebar-header {
        padding: 1rem;
        border-bottom: 1px solid var(--line);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .sidebar-header h2 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* Collapsible Sidebar */
      .admin-container {
        display: grid;
        grid-template-columns: 280px 1fr;
        min-height: calc(100vh - 60px);
        transition: grid-template-columns 0.3s ease;
      }

      .admin-container.sidebar-collapsed {
        grid-template-columns: 48px 1fr;
      }

      .sidebar {
        background: var(--bg-card);
        border-right: 1px solid var(--line);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
      }

      .sidebar-collapsed .sidebar {
        width: 48px;
      }

      .sidebar-collapsed .sidebar .sidebar-header h2,
      .sidebar-collapsed .sidebar .paper-count,
      .sidebar-collapsed .sidebar .paper-item-info,
      .sidebar-collapsed .sidebar .paper-item-actions,
      .sidebar-collapsed .sidebar .sidebar-footer span {
        opacity: 0;
        visibility: hidden;
      }

      .sidebar-collapsed .sidebar .paper-item {
        justify-content: center;
        padding: 0.75rem;
      }

      .sidebar-collapsed .sidebar .paper-item::before {
        content: attr(data-initial);
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
      }

      /* Hover expand */
      .sidebar-collapsed .sidebar:hover {
        position: absolute;
        width: 280px;
        height: calc(100vh - 60px);
        z-index: 50;
        box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
      }

      .sidebar-collapsed .sidebar:hover .sidebar-header h2,
      .sidebar-collapsed .sidebar:hover .paper-count,
      .sidebar-collapsed .sidebar:hover .paper-item-info,
      .sidebar-collapsed .sidebar:hover .paper-item-actions,
      .sidebar-collapsed .sidebar:hover .sidebar-footer span {
        opacity: 1;
        visibility: visible;
      }

      .sidebar-collapsed .sidebar:hover .paper-item {
        justify-content: space-between;
        padding: 0.875rem 1rem;
      }

      .sidebar-collapsed .sidebar:hover .paper-item::before {
        display: none;
      }

      /* Toggle button */
      .sidebar-toggle {
        position: absolute;
        right: -12px;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 24px;
        background: var(--bg-card);
        border: 1px solid var(--line);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        font-size: 0.7rem;
        z-index: 60;
        transition: all 0.2s;
      }

      .sidebar-toggle:hover {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
      }

      .sidebar-collapsed .sidebar-toggle i {
        transform: rotate(180deg);
      }

      .paper-count {
        font-size: 0.75rem;
        background: var(--line);
        padding: 2px 8px;
        border-radius: 10px;
        color: var(--text-muted);
      }

      .paper-list {
        list-style: none;
        flex: 1;
        overflow-y: auto;
      }

      .paper-item {
        padding: 0.875rem 1rem;
        border-bottom: 1px solid var(--line-light);
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 8px;
      }

      .paper-item:hover {
        background: var(--line-light);
      }

      .paper-item.active {
        background: rgba(201, 120, 93, 0.1);
        border-left: 3px solid var(--accent);
      }

      .paper-item-info {
        flex: 1;
        min-width: 0;
      }

      .paper-item-info h3 {
        font-size: 0.85rem;
        font-weight: 500;
        margin-bottom: 2px;
        color: var(--text-main);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-transform: capitalize;
      }

      .paper-item-info p {
        font-size: 0.7rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .paper-item-actions {
        display: flex;
        gap: 4px;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .paper-item:hover .paper-item-actions {
        opacity: 1;
      }

      .icon-btn {
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        padding: 4px 6px;
        border-radius: 4px;
        transition: all 0.2s;
        font-size: 0.75rem;
      }

      .icon-btn:hover {
        background: var(--line);
        color: var(--text-main);
      }

      .icon-btn.delete:hover {
        background: rgba(199, 93, 93, 0.2);
        color: var(--danger);
      }

      .icon-btn.duplicate:hover {
        background: rgba(93, 157, 201, 0.2);
        color: var(--info);
      }

      /* Editor Area */
      .editor-area {
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .editor-toolbar {
        padding: 0.75rem 1rem;
        background: var(--bg-card);
        border-bottom: 1px solid var(--line);
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .input-group label {
        font-size: 0.65rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .input-group input {
        background: var(--bg-input);
        border: 1px solid var(--line);
        border-radius: 6px;
        padding: 6px 10px;
        color: var(--text-main);
        font-family: "Fira Code", monospace;
        font-size: 0.85rem;
        width: 220px;
      }

      .input-group input:focus {
        outline: none;
        border-color: var(--accent);
      }

      .toolbar-divider {
        width: 1px;
        height: 30px;
        background: var(--line);
        margin: 0 4px;
      }

      .toolbar-right {
        margin-left: auto;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      /* Word count */
      .word-count {
        font-size: 0.75rem;
        color: var(--text-muted);
        padding: 4px 10px;
        background: var(--bg-input);
        border-radius: 4px;
        display: flex;
        gap: 12px;
      }

      .word-count span {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .editor-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        flex: 1;
        overflow: hidden;
      }

      .editor-content.preview-only {
        grid-template-columns: 0 1fr;
      }

      .editor-content.editor-only {
        grid-template-columns: 1fr 0;
      }

      .editor-pane,
      .preview-pane {
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .pane-header {
        padding: 0.5rem 1rem;
        background: var(--bg-card);
        border-bottom: 1px solid var(--line);
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .pane-header-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .pane-header i {
        color: var(--accent);
      }

      .editor-pane {
        border-right: 1px solid var(--line);
      }

      textarea#markdown-editor {
        flex: 1;
        background: var(--bg-body);
        border: none;
        padding: 1.25rem;
        color: var(--text-main);
        font-family: "Fira Code", monospace;
        font-size: 0.875rem;
        line-height: 1.7;
        resize: none;
        outline: none;
        tab-size: 2;
      }

      textarea#markdown-editor::placeholder {
        color: var(--text-muted);
      }

      .preview-content {
        flex: 1;
        overflow-y: auto;
        padding: 1.25rem;
        background: var(--bg-body);
      }

      /* Preview Styling */
      .preview-content h1 {
        font-family: "Lora", serif;
        font-size: 1.6rem;
        margin-bottom: 0.5rem;
        color: var(--text-main);
      }

      .preview-content h2 {
        font-family: "Lora", serif;
        font-size: 1.2rem;
        margin: 1.25rem 0 0.6rem;
        color: var(--text-main);
      }

      .preview-content h3 {
        font-size: 1rem;
        margin: 1rem 0 0.5rem;
        color: var(--text-main);
      }

      .preview-content p {
        margin-bottom: 0.875rem;
        color: var(--text-light);
      }

      .preview-content em {
        color: var(--text-muted);
      }

      .preview-content ul,
      .preview-content ol {
        margin: 0.875rem 0 0.875rem 1.5rem;
        color: var(--text-light);
      }

      .preview-content li {
        margin-bottom: 0.4rem;
      }

      .preview-content strong {
        color: var(--text-main);
      }

      .preview-content a {
        color: var(--accent);
      }

      .preview-content blockquote {
        border-left: 3px solid var(--accent);
        margin: 1rem 0;
        padding: 0.5rem 1rem;
        background: var(--bg-card);
        border-radius: 0 6px 6px 0;
      }

      .preview-content code {
        background: var(--bg-card);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Fira Code", monospace;
        font-size: 0.85em;
      }

      .preview-content pre {
        background: var(--bg-card);
        padding: 1rem;
        border-radius: 6px;
        overflow-x: auto;
        margin: 1rem 0;
      }

      .preview-content pre code {
        background: none;
        padding: 0;
      }

      /* Empty State */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: var(--text-muted);
        text-align: center;
        padding: 2rem;
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.3;
      }

      .empty-state h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--text-light);
      }

      /* Keyboard shortcuts hint */
      .shortcuts-hint {
        font-size: 0.7rem;
        color: var(--text-muted);
        margin-top: 1rem;
      }

      .shortcuts-hint kbd {
        background: var(--line);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: inherit;
        margin: 0 2px;
      }

      /* Toast */
      .toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 10px;
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s;
        z-index: 1000;
      }

      .toast.show {
        transform: translateY(0);
        opacity: 1;
      }

      .toast.success {
        background: var(--success);
        color: white;
      }

      .toast.error {
        background: var(--danger);
        color: white;
      }

      .toast.info {
        background: var(--info);
        color: white;
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
      }

      .modal-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .modal {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 1.5rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
      }

      .modal h3 {
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .modal p {
        color: var(--text-muted);
        margin-bottom: 1.25rem;
        font-size: 0.9rem;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
      }

      /* Template Dropdown */
      .dropdown {
        position: relative;
      }

      .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        background: var(--bg-card);
        border: 1px solid var(--line);
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        min-width: 180px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.2s;
        z-index: 100;
      }

      .dropdown-menu.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(5px);
      }

      .dropdown-option {
        display: flex;
        align-items: center;
        gap: 10px;
        width: 100%;
        padding: 10px 14px;
        text-align: left;
        background: none;
        border: none;
        color: var(--text-main);
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .dropdown-option i {
        color: var(--text-muted);
        width: 16px;
      }

      .dropdown-option:hover {
        background: var(--line-light);
        color: var(--accent);
      }

      .dropdown-option:hover i {
        color: var(--accent);
      }

      .dropdown-option:first-child {
        border-radius: 8px 8px 0 0;
      }

      .dropdown-option:last-child {
        border-radius: 0 0 8px 8px;
      }

      .dropdown-divider {
        height: 1px;
        background: var(--line);
        margin: 4px 0;
      }

      /* Autosave indicator */
      .autosave-indicator {
        font-size: 0.75rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .autosave-indicator.saving {
        color: var(--warning);
      }

      .autosave-indicator.saved {
        color: var(--success);
      }

      .autosave-indicator i {
        font-size: 0.7rem;
      }

      /* Unsaved indicator */
      .unsaved-dot {
        width: 8px;
        height: 8px;
        background: var(--warning);
        border-radius: 50%;
        display: none;
      }

      .unsaved-dot.show {
        display: inline-block;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* View toggle */
      .view-toggle {
        display: flex;
        background: var(--bg-input);
        border-radius: 6px;
        padding: 2px;
      }

      .view-toggle button {
        background: none;
        border: none;
        color: var(--text-muted);
        padding: 4px 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.8rem;
      }

      .view-toggle button:hover {
        color: var(--text-main);
      }

      .view-toggle button.active {
        background: var(--accent);
        color: white;
      }

      /* Responsive */
      @media (max-width: 900px) {
        .admin-container {
          grid-template-columns: 1fr;
        }

        .sidebar {
          display: none;
        }

        .editor-content {
          grid-template-columns: 1fr;
        }

        .preview-pane {
          display: none;
        }

        .input-group input {
          width: 160px;
        }

        .header-search input {
          width: 150px;
        }

        .word-count {
          display: none;
        }
      }

      /* Sidebar footer */
      .sidebar-footer {
        padding: 0.75rem 1rem;
        border-top: 1px solid var(--line);
        background: var(--bg-card);
      }

      .sidebar-footer button {
        width: 100%;
      }

      /* Quick insert bar */
      .quick-insert {
        display: flex;
        gap: 4px;
        padding: 0.5rem 1rem;
        background: var(--bg-card);
        border-bottom: 1px solid var(--line);
        overflow-x: auto;
      }

      .quick-insert button {
        background: var(--bg-input);
        border: 1px solid var(--line);
        color: var(--text-muted);
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
        font-family: "Fira Code", monospace;
      }

      .quick-insert button:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      /* Drag handle for resize */
      .resize-handle {
        width: 4px;
        background: var(--line);
        cursor: col-resize;
        transition: background 0.2s;
      }

      .resize-handle:hover {
        background: var(--accent);
      }
    </style>
  </head>
  <body>
    <header class="admin-header">
      <h1><i class="fas fa-cog"></i> Admin Panel</h1>
      <div class="header-actions">
        <div class="header-search">
          <i class="fas fa-search"></i>
          <input
            type="text"
            id="search-papers"
            placeholder="Search papers..."
          />
        </div>
        <button class="btn-icon" id="shortcuts-btn" title="Keyboard Shortcuts">
          <i class="fas fa-keyboard"></i>
        </button>
        <a href="index.html" class="btn btn-secondary" target="_blank">
          <i class="fas fa-external-link-alt"></i> View Site
        </a>
      </div>
    </header>

    <div class="admin-container">
      <!-- Sidebar -->
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <button
          class="sidebar-toggle"
          id="sidebar-toggle"
          title="Toggle Sidebar"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
        <div class="sidebar-header">
          <h2>Papers</h2>
          <span class="paper-count" id="paper-count">0</span>
        </div>
        <ul class="paper-list" id="paper-list">
          <!-- Papers loaded dynamically -->
        </ul>
        <div class="sidebar-footer">
          <button
            class="btn btn-primary"
            id="new-btn-sidebar"
            style="width: 100%"
          >
            <i class="fas fa-plus"></i> New Paper
          </button>
        </div>
      </aside>

      <!-- Editor -->
      <main class="editor-area">
        <div class="editor-toolbar">
          <div class="input-group">
            <label for="filename">Filename</label>
            <input type="text" id="filename" placeholder="my-paper.md" />
          </div>

          <div class="toolbar-divider"></div>

          <div class="dropdown">
            <button class="btn btn-secondary" id="template-btn">
              <i class="fas fa-file-alt"></i> Templates
            </button>
            <div class="dropdown-menu" id="template-menu">
              <button class="dropdown-option" data-template="basic">
                <i class="fas fa-file"></i> Basic Paper
              </button>
              <button class="dropdown-option" data-template="research">
                <i class="fas fa-flask"></i> Research Article
              </button>
              <button class="dropdown-option" data-template="literature">
                <i class="fas fa-book"></i> Literature Review
              </button>
              <button class="dropdown-option" data-template="notes">
                <i class="fas fa-sticky-note"></i> Quick Notes
              </button>
              <div class="dropdown-divider"></div>
              <button class="dropdown-option" data-template="empty">
                <i class="fas fa-file-medical"></i> Empty Document
              </button>
            </div>
          </div>

          <div class="dropdown">
            <button class="btn btn-secondary" id="insert-btn">
              <i class="fas fa-plus-circle"></i> Insert
            </button>
            <div class="dropdown-menu" id="insert-menu">
              <button class="dropdown-option" data-insert="heading">
                <i class="fas fa-heading"></i> Heading
              </button>
              <button class="dropdown-option" data-insert="link">
                <i class="fas fa-link"></i> Link
              </button>
              <button class="dropdown-option" data-insert="image">
                <i class="fas fa-image"></i> Image
              </button>
              <button class="dropdown-option" data-insert="list">
                <i class="fas fa-list"></i> Bullet List
              </button>
              <button class="dropdown-option" data-insert="quote">
                <i class="fas fa-quote-left"></i> Blockquote
              </button>
              <button class="dropdown-option" data-insert="math">
                <i class="fas fa-square-root-alt"></i> Math Equation
              </button>
              <button class="dropdown-option" data-insert="table">
                <i class="fas fa-table"></i> Table
              </button>
            </div>
          </div>

          <div class="toolbar-right">
            <div class="word-count" id="word-count">
              <span
                ><i class="fas fa-font"></i>
                <span id="wc-words">0</span> words</span
              >
              <span
                ><i class="fas fa-paragraph"></i>
                <span id="wc-chars">0</span> chars</span
              >
            </div>

            <div class="toolbar-divider"></div>

            <div class="view-toggle">
              <button data-view="split" class="active" title="Split View">
                <i class="fas fa-columns"></i>
              </button>
              <button data-view="editor" title="Editor Only">
                <i class="fas fa-edit"></i>
              </button>
              <button data-view="preview" title="Preview Only">
                <i class="fas fa-eye"></i>
              </button>
            </div>

            <div class="toolbar-divider"></div>

            <div class="autosave-indicator" id="autosave-indicator">
              <i class="fas fa-circle"></i>
              <span>Ready</span>
            </div>

            <span
              class="unsaved-dot"
              id="unsaved-dot"
              title="Unsaved changes"
            ></span>

            <button class="btn btn-primary" id="save-btn">
              <i class="fas fa-save"></i> Save
            </button>
          </div>
        </div>

        <!-- Quick Insert Bar -->
        <div class="quick-insert">
          <button data-quick="**bold**" title="Bold">**B**</button>
          <button data-quick="*italic*" title="Italic">*I*</button>
          <button data-quick="# " title="Heading"># H1</button>
          <button data-quick="## " title="Heading 2">## H2</button>
          <button data-quick="### " title="Heading 3">### H3</button>
          <button data-quick="- " title="List item">‚Ä¢ List</button>
          <button data-quick="1. " title="Numbered item">1. Num</button>
          <button data-quick="[text](url)" title="Link">üîó Link</button>
          <button data-quick="$equation$" title="Inline Math">‚àë Math</button>
          <button data-quick="> " title="Quote">‚ùù Quote</button>
          <button data-quick="---" title="Horizontal Rule">‚Äî HR</button>
        </div>

        <div class="editor-content" id="editor-content">
          <div class="editor-pane">
            <div class="pane-header">
              <div class="pane-header-left">
                <i class="fas fa-code"></i> Markdown
              </div>
            </div>
            <textarea
              id="markdown-editor"
              placeholder="Start writing your paper in Markdown...

# Paper Title

*Author Name ‚Äî Month Year*

## Abstract

Write your abstract here...

## Introduction

Your introduction...

Tip: Use Ctrl+S to save, Ctrl+B for bold, Ctrl+I for italic"
            ></textarea>
          </div>

          <div class="preview-pane">
            <div class="pane-header">
              <div class="pane-header-left">
                <i class="fas fa-eye"></i> Preview
              </div>
            </div>
            <div class="preview-content" id="preview-content">
              <div class="empty-state">
                <i class="fas fa-file-alt"></i>
                <h3>Live Preview</h3>
                <p>Start typing to see your formatted paper</p>
                <div class="shortcuts-hint">
                  <kbd>Ctrl</kbd>+<kbd>S</kbd> Save &nbsp; <kbd>Ctrl</kbd>+<kbd
                    >B</kbd
                  >
                  Bold &nbsp; <kbd>Ctrl</kbd>+<kbd>I</kbd> Italic
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Delete Modal -->
    <div class="modal-overlay" id="delete-modal">
      <div class="modal">
        <h3>
          <i
            class="fas fa-exclamation-triangle"
            style="color: var(--danger)"
          ></i>
          Delete Paper?
        </h3>
        <p>
          Are you sure you want to delete "<span id="delete-filename"></span>"?
          This cannot be undone.
        </p>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancel-delete">Cancel</button>
          <button class="btn btn-danger" id="confirm-delete">Delete</button>
        </div>
      </div>
    </div>

    <!-- Shortcuts Modal -->
    <div class="modal-overlay" id="shortcuts-modal">
      <div class="modal" style="max-width: 500px; text-align: left">
        <h3 style="justify-content: flex-start">
          <i class="fas fa-keyboard" style="color: var(--accent)"></i> Keyboard
          Shortcuts
        </h3>
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 1rem;
          "
        >
          <div><kbd>Ctrl</kbd>+<kbd>S</kbd> Save</div>
          <div><kbd>Ctrl</kbd>+<kbd>B</kbd> Bold</div>
          <div><kbd>Ctrl</kbd>+<kbd>I</kbd> Italic</div>
          <div><kbd>Ctrl</kbd>+<kbd>K</kbd> Insert Link</div>
          <div><kbd>Ctrl</kbd>+<kbd>N</kbd> New Paper</div>
          <div><kbd>Ctrl</kbd>+<kbd>D</kbd> Duplicate</div>
          <div><kbd>Ctrl</kbd>+<kbd>/</kbd> Toggle Preview</div>
          <div><kbd>Esc</kbd> Close Modals</div>
        </div>
        <div class="modal-actions" style="margin-top: 1.5rem">
          <button class="btn btn-secondary" id="close-shortcuts">Close</button>
        </div>
      </div>
    </div>

    <script>
      // State
      let papers = [];
      let currentFile = null;
      let hasUnsavedChanges = false;
      let autosaveTimer = null;
      let searchQuery = "";

      // DOM Elements
      const paperList = document.getElementById("paper-list");
      const paperCount = document.getElementById("paper-count");
      const filenameInput = document.getElementById("filename");
      const editor = document.getElementById("markdown-editor");
      const preview = document.getElementById("preview-content");
      const editorContent = document.getElementById("editor-content");
      const saveBtn = document.getElementById("save-btn");
      const templateBtn = document.getElementById("template-btn");
      const templateMenu = document.getElementById("template-menu");
      const insertBtn = document.getElementById("insert-btn");
      const insertMenu = document.getElementById("insert-menu");
      const toast = document.getElementById("toast");
      const deleteModal = document.getElementById("delete-modal");
      const deleteFilename = document.getElementById("delete-filename");
      const shortcutsModal = document.getElementById("shortcuts-modal");
      const unsavedDot = document.getElementById("unsaved-dot");
      const autosaveIndicator = document.getElementById("autosave-indicator");
      const searchInput = document.getElementById("search-papers");

      // Templates
      const templates = {
        basic: `# Paper Title

*Your Name ‚Äî ${new Date().toLocaleDateString("en-US", {
          month: "long",
          year: "numeric",
        })}*

## Abstract

Brief summary of your paper...

## Introduction

Introduction content here...

## Main Content

Your main content...

## Conclusion

Concluding thoughts...

---

**References:**

Author, A. A. (Year). Title. *Journal*, Volume(Issue), pages.`,

        research: `#clinical #research

# Research Paper Title

*Your Name ‚Äî ${new Date().toLocaleDateString("en-US", {
          month: "long",
          year: "numeric",
        })}*

## Abstract

A concise summary of the research objectives, methodology, key findings, and conclusions (150-250 words).

## Introduction

Background information and context for the research. State the research question or hypothesis.

## Literature Review

Summary of relevant previous research and theoretical framework.

## Method

### Participants
Description of participants (N = X, demographics).

### Materials
Instruments, questionnaires, or tools used.

### Procedure
Step-by-step description of the research process.

## Results

Present findings with statistics:
- Mean: $M = 0.00$, $SD = 0.00$
- Correlation: $r = .00$, $p < .05$

## Discussion

Interpretation of results, implications, limitations, and future directions.

## Conclusion

Summary of key findings and their significance.

---

**References:**

Author, A. A. (Year). Title of article. *Journal Name*, Volume(Issue), pages. https://doi.org/xxxxx

[Read Full Article](https://doi.org/xxxxx)`,

        literature: `#review #literature

# Literature Review: Topic Name

*Your Name ‚Äî ${new Date().toLocaleDateString("en-US", {
          month: "long",
          year: "numeric",
        })}*

## Introduction

Overview of the topic and significance of the review.

## Search Methodology

Description of databases searched, keywords used, and inclusion/exclusion criteria.

## Themes and Findings

### Theme 1: [Name]
Summary of findings related to this theme...

### Theme 2: [Name]
Summary of findings related to this theme...

### Theme 3: [Name]
Summary of findings related to this theme...

## Critical Analysis

Strengths and limitations of the current literature, gaps identified.

## Conclusion

Summary and implications for future research.

---

**References:**

1. Author, A. (Year). Title. *Journal*, Volume, pages.
2. Author, B. (Year). Title. *Journal*, Volume, pages.`,

        notes: `# Quick Notes: Topic Name

*${new Date().toLocaleDateString("en-US", {
          month: "long",
          day: "numeric",
          year: "numeric",
        })}*

## Key Points

- Point 1
- Point 2
- Point 3

## Summary

Brief summary here...

## Questions to Explore

- [ ] Question 1
- [ ] Question 2

## References

- Source 1
- Source 2`,

        empty: ``,
      };

      // Insert snippets
      const insertSnippets = {
        heading: "## Heading\n\n",
        link: "[Link Text](https://example.com)",
        image: "![Alt Text](image-url.jpg)",
        list: "- Item 1\n- Item 2\n- Item 3\n",
        quote: "> Blockquote text here\n",
        math: "$$\nE = mc^2\n$$\n",
        table:
          "| Header 1 | Header 2 | Header 3 |\n|----------|----------|----------|\n| Cell 1   | Cell 2   | Cell 3   |\n| Cell 4   | Cell 5   | Cell 6   |\n",
      };

      // Load papers
      async function loadPapers() {
        try {
          const response = await fetch("/api/papers");
          const data = await response.json();
          papers = Array.isArray(data) ? data : data.files || [];
          renderPaperList();
        } catch (error) {
          showToast("Failed to load papers", "error");
        }
      }

      // Render paper list
      function renderPaperList() {
        const filtered = searchQuery
          ? papers.filter((p) =>
              p.toLowerCase().includes(searchQuery.toLowerCase())
            )
          : papers;

        paperCount.textContent = papers.length;

        if (filtered.length === 0) {
          paperList.innerHTML = `
            <li class="empty-state" style="padding: 2rem; border: none;">
              <i class="fas fa-search" style="font-size: 2rem;"></i>
              <p style="margin-top: 0.5rem;">${
                searchQuery ? "No papers found" : "No papers yet"
              }</p>
            </li>
          `;
          return;
        }

        paperList.innerHTML = filtered
          .map(
            (filename) => `
          <li class="paper-item ${
            currentFile === filename ? "active" : ""
          }" data-file="${filename}">
            <div class="paper-item-info">
              <h3>${filename.replace(".md", "").replace(/-/g, " ")}</h3>
              <p><i class="fas fa-file-alt"></i> ${filename}</p>
            </div>
            <div class="paper-item-actions">
              <button class="icon-btn duplicate" data-file="${filename}" title="Duplicate">
                <i class="fas fa-copy"></i>
              </button>
              <button class="icon-btn delete" data-file="${filename}" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </li>
        `
          )
          .join("");

        // Add click handlers
        document.querySelectorAll(".paper-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            if (!e.target.closest(".icon-btn")) {
              loadPaper(item.dataset.file);
            }
          });
        });

        document.querySelectorAll(".icon-btn.delete").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            showDeleteModal(btn.dataset.file);
          });
        });

        document.querySelectorAll(".icon-btn.duplicate").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.stopPropagation();
            duplicatePaper(btn.dataset.file);
          });
        });
      }

      // Load a paper for editing
      async function loadPaper(filename) {
        if (
          hasUnsavedChanges &&
          !confirm("You have unsaved changes. Continue?")
        ) {
          return;
        }

        try {
          const response = await fetch(`/papers/${filename}`);
          if (!response.ok) throw new Error("Failed to load");
          const content = await response.text();

          currentFile = filename;
          filenameInput.value = filename;
          editor.value = content;
          updatePreview();
          updateWordCount();
          setUnsaved(false);
          renderPaperList();
          showToast(`Loaded: ${filename}`, "info");
        } catch (error) {
          showToast("Failed to load paper", "error");
        }
      }

      // Save paper
      async function savePaper() {
        const filename = filenameInput.value.trim();
        const content = editor.value;

        if (!filename) {
          showToast("Please enter a filename", "error");
          filenameInput.focus();
          return;
        }

        const finalFilename = filename.endsWith(".md")
          ? filename
          : filename + ".md";
        filenameInput.value = finalFilename;

        updateAutosaveIndicator("saving");

        try {
          const response = await fetch("/api/papers/save", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ filename: finalFilename, content }),
          });

          if (!response.ok) throw new Error("Failed to save");

          currentFile = finalFilename;
          setUnsaved(false);
          updateAutosaveIndicator("saved");
          showToast("Saved!", "success");
          loadPapers();
        } catch (error) {
          updateAutosaveIndicator("error");
          showToast("Failed to save", "error");
        }
      }

      // Duplicate paper
      async function duplicatePaper(filename) {
        try {
          const response = await fetch(`/papers/${filename}`);
          if (!response.ok) throw new Error("Failed to load");
          const content = await response.text();

          const newFilename = filename.replace(".md", "-copy.md");
          filenameInput.value = newFilename;
          editor.value = content;
          currentFile = null;
          updatePreview();
          updateWordCount();
          setUnsaved(true);
          renderPaperList();
          showToast("Paper duplicated - remember to save!", "info");
        } catch (error) {
          showToast("Failed to duplicate", "error");
        }
      }

      // Delete paper
      async function deletePaper(filename) {
        try {
          const response = await fetch("/api/papers/delete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ filename }),
          });

          if (!response.ok) throw new Error("Failed to delete");

          if (currentFile === filename) {
            newPaper();
          }

          showToast("Paper deleted", "success");
          loadPapers();
        } catch (error) {
          showToast("Failed to delete", "error");
        }
      }

      // New paper
      function newPaper() {
        if (
          hasUnsavedChanges &&
          !confirm("You have unsaved changes. Continue?")
        ) {
          return;
        }

        currentFile = null;
        filenameInput.value = "";
        editor.value = "";
        preview.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-file-alt"></i>
            <h3>Live Preview</h3>
            <p>Start typing to see your formatted paper</p>
            <div class="shortcuts-hint">
              <kbd>Ctrl</kbd>+<kbd>S</kbd> Save &nbsp;
              <kbd>Ctrl</kbd>+<kbd>B</kbd> Bold &nbsp;
              <kbd>Ctrl</kbd>+<kbd>I</kbd> Italic
            </div>
          </div>
        `;
        updateWordCount();
        setUnsaved(false);
        updateAutosaveIndicator("ready");
        renderPaperList();
        filenameInput.focus();
      }

      // Update preview
      function updatePreview() {
        const content = editor.value;
        if (!content.trim()) {
          preview.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-file-alt"></i>
              <h3>Live Preview</h3>
              <p>Start typing to see your formatted paper</p>
            </div>
          `;
          return;
        }

        // Remove keyword lines for preview
        const cleanContent = content
          .replace(/^#[\w-]+(\s+#[\w-]+)*\s*$/gm, "")
          .trim();
        preview.innerHTML = marked.parse(cleanContent);

        // Render math
        if (window.renderMathInElement) {
          renderMathInElement(preview, {
            delimiters: [
              { left: "$$", right: "$$", display: true },
              { left: "$", right: "$", display: false },
            ],
            throwOnError: false,
          });
        }
      }

      // Update word count
      function updateWordCount() {
        const text = editor.value.trim();
        const words = text
          ? text.split(/\s+/).filter((w) => w.length > 0).length
          : 0;
        const chars = text.length;
        document.getElementById("wc-words").textContent = words;
        document.getElementById("wc-chars").textContent = chars;
      }

      // Set unsaved state
      function setUnsaved(value) {
        hasUnsavedChanges = value;
        unsavedDot.classList.toggle("show", value);

        // Trigger autosave after 3 seconds of inactivity
        if (value && currentFile) {
          clearTimeout(autosaveTimer);
          autosaveTimer = setTimeout(() => {
            if (hasUnsavedChanges) {
              savePaper();
            }
          }, 5000);
        }
      }

      // Update autosave indicator
      function updateAutosaveIndicator(status) {
        const indicator = autosaveIndicator;
        indicator.className = "autosave-indicator";

        switch (status) {
          case "saving":
            indicator.classList.add("saving");
            indicator.innerHTML =
              '<i class="fas fa-circle-notch fa-spin"></i> Saving...';
            break;
          case "saved":
            indicator.classList.add("saved");
            indicator.innerHTML = '<i class="fas fa-check-circle"></i> Saved';
            setTimeout(() => updateAutosaveIndicator("ready"), 2000);
            break;
          case "error":
            indicator.innerHTML =
              '<i class="fas fa-exclamation-circle" style="color: var(--danger)"></i> Error';
            break;
          default:
            indicator.innerHTML = '<i class="fas fa-circle"></i> Ready';
        }
      }

      // Show toast
      function showToast(message, type = "success") {
        toast.textContent = message;
        toast.className = `toast ${type} show`;
        setTimeout(() => toast.classList.remove("show"), 2500);
      }

      // Show delete modal
      function showDeleteModal(filename) {
        deleteFilename.textContent = filename;
        deleteModal.classList.add("show");
        deleteModal.dataset.file = filename;
      }

      // Insert text at cursor
      function insertAtCursor(text, selectText = false) {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        const before = editor.value.substring(0, start);
        const after = editor.value.substring(end);

        editor.value = before + text + after;
        editor.focus();

        if (selectText) {
          editor.selectionStart = start;
          editor.selectionEnd = start + text.length;
        } else {
          editor.selectionStart = editor.selectionEnd = start + text.length;
        }

        updatePreview();
        updateWordCount();
        setUnsaved(true);
      }

      // Wrap selection with text
      function wrapSelection(before, after) {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        const selected = editor.value.substring(start, end);
        const beforeText = editor.value.substring(0, start);
        const afterText = editor.value.substring(end);

        editor.value = beforeText + before + selected + after + afterText;
        editor.focus();
        editor.selectionStart = start + before.length;
        editor.selectionEnd = end + before.length;

        updatePreview();
        updateWordCount();
        setUnsaved(true);
      }

      // Event Listeners
      editor.addEventListener("input", () => {
        updatePreview();
        updateWordCount();
        setUnsaved(true);
      });

      // Tab key support
      editor.addEventListener("keydown", (e) => {
        if (e.key === "Tab") {
          e.preventDefault();
          insertAtCursor("  ");
        }
      });

      saveBtn.addEventListener("click", savePaper);
      document
        .getElementById("new-btn-sidebar")
        .addEventListener("click", newPaper);

      // Search
      searchInput.addEventListener("input", (e) => {
        searchQuery = e.target.value;
        renderPaperList();
      });

      // Template dropdown
      templateBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        templateMenu.classList.toggle("show");
        insertMenu.classList.remove("show");
      });

      document
        .querySelectorAll("#template-menu .dropdown-option")
        .forEach((option) => {
          option.addEventListener("click", () => {
            const template = templates[option.dataset.template];
            if (
              editor.value &&
              !confirm("This will replace current content. Continue?")
            ) {
              return;
            }
            editor.value = template;
            updatePreview();
            updateWordCount();
            setUnsaved(true);
            templateMenu.classList.remove("show");
          });
        });

      // Insert dropdown
      insertBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        insertMenu.classList.toggle("show");
        templateMenu.classList.remove("show");
      });

      document
        .querySelectorAll("#insert-menu .dropdown-option")
        .forEach((option) => {
          option.addEventListener("click", () => {
            const snippet = insertSnippets[option.dataset.insert];
            insertAtCursor(snippet);
            insertMenu.classList.remove("show");
          });
        });

      // Quick insert buttons
      document.querySelectorAll(".quick-insert button").forEach((btn) => {
        btn.addEventListener("click", () => {
          insertAtCursor(btn.dataset.quick);
        });
      });

      // View toggle
      document.querySelectorAll(".view-toggle button").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".view-toggle button")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          editorContent.className = "editor-content";
          if (btn.dataset.view === "editor") {
            editorContent.classList.add("editor-only");
          } else if (btn.dataset.view === "preview") {
            editorContent.classList.add("preview-only");
          }
        });
      });

      // Shortcuts button
      document.getElementById("shortcuts-btn").addEventListener("click", () => {
        shortcutsModal.classList.add("show");
      });

      document
        .getElementById("close-shortcuts")
        .addEventListener("click", () => {
          shortcutsModal.classList.remove("show");
        });

      // Delete modal
      document.getElementById("cancel-delete").addEventListener("click", () => {
        deleteModal.classList.remove("show");
      });

      document
        .getElementById("confirm-delete")
        .addEventListener("click", () => {
          deletePaper(deleteModal.dataset.file);
          deleteModal.classList.remove("show");
        });

      // Close dropdowns/modals on outside click
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".dropdown")) {
          templateMenu.classList.remove("show");
          insertMenu.classList.remove("show");
        }
      });

      // Keyboard shortcuts
      document.addEventListener("keydown", (e) => {
        // Escape to close modals
        if (e.key === "Escape") {
          deleteModal.classList.remove("show");
          shortcutsModal.classList.remove("show");
          templateMenu.classList.remove("show");
          insertMenu.classList.remove("show");
        }

        // Only if editor is focused or using Ctrl
        if (e.ctrlKey || e.metaKey) {
          switch (e.key.toLowerCase()) {
            case "s":
              e.preventDefault();
              savePaper();
              break;
            case "b":
              e.preventDefault();
              wrapSelection("**", "**");
              break;
            case "i":
              e.preventDefault();
              wrapSelection("*", "*");
              break;
            case "k":
              e.preventDefault();
              const selected = editor.value.substring(
                editor.selectionStart,
                editor.selectionEnd
              );
              insertAtCursor(`[${selected || "Link Text"}](url)`);
              break;
            case "n":
              e.preventDefault();
              newPaper();
              break;
            case "/":
              e.preventDefault();
              const previewBtn = document.querySelector(
                '.view-toggle button[data-view="preview"]'
              );
              const splitBtn = document.querySelector(
                '.view-toggle button[data-view="split"]'
              );
              if (editorContent.classList.contains("preview-only")) {
                splitBtn.click();
              } else {
                previewBtn.click();
              }
              break;
          }
        }
      });

      // Warn before leaving with unsaved changes
      window.addEventListener("beforeunload", (e) => {
        if (hasUnsavedChanges) {
          e.preventDefault();
          e.returnValue = "";
        }
      });

      // Initialize
      loadPapers();
    </script>
  </body>
</html>
