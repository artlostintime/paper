<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel | Portfolio</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚙️</text></svg>"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lora:ital,wght@0,400;0,600;1,400&family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
    />

    <link rel="stylesheet" href="admin.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark-dimmed.min.css"
    />
    <!-- Prevent theme flash -->
    <script>
      (function () {
        var t = localStorage.getItem("admin-theme") || "dark";
        document.documentElement.setAttribute("data-theme", t);
      })();
    </script>
  </head>
  <body>
    <!-- Login Screen -->
    <div class="login-screen" id="login-screen">
      <div class="login-card">
        <div class="login-header">
          <i class="fas fa-shield-alt"></i>
          <h2>Admin Login</h2>
          <p>Enter your password to access the admin panel</p>
        </div>
        <form id="login-form">
          <div class="login-input-group">
            <i class="fas fa-key"></i>
            <input
              type="password"
              id="login-password"
              placeholder="Password"
              autocomplete="current-password"
              required
            />
            <button
              type="button"
              class="toggle-password"
              id="toggle-password"
              title="Show/Hide Password"
              aria-label="Toggle password visibility"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <div class="login-error" id="login-error"></div>
          <button type="submit" class="btn btn-primary login-btn">
            <i class="fas fa-sign-in-alt"></i> Login
          </button>
        </form>
        <div class="login-footer">
          <a href="../index.html"
            ><i class="fas fa-arrow-left"></i> Back to Site</a
          >
        </div>
      </div>
    </div>

    <!-- Admin App (hidden until authenticated) -->
    <div class="admin-app" id="admin-app" style="display: none">
      <!-- ── Title Bar ── -->
      <header class="titlebar">
        <div class="titlebar-left">
          <i class="fas fa-cog titlebar-icon"></i>
          <span class="titlebar-title">Admin Panel</span>
        </div>
        <div class="titlebar-center">
          <button
            class="command-trigger"
            id="command-palette-btn"
            title="Command Palette (Ctrl+P)"
          >
            <i class="fas fa-search"></i>
            <span>Search papers…</span>
            <kbd>Ctrl+P</kbd>
          </button>
        </div>
        <div class="titlebar-right">
          <button
            class="titlebar-btn"
            id="theme-toggle"
            title="Toggle Theme (Ctrl+Shift+T)"
          >
            <i class="fas fa-moon"></i>
          </button>
          <button
            class="titlebar-btn"
            id="shortcuts-btn"
            title="Keyboard Shortcuts"
          >
            <i class="fas fa-keyboard"></i>
          </button>
          <a
            href="../index.html"
            class="titlebar-btn"
            target="_blank"
            title="View Site"
          >
            <i class="fas fa-external-link-alt"></i>
          </a>
          <button class="titlebar-btn logout" id="logout-btn" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </header>

      <div class="workbench">
        <!-- ── Activity Bar ── -->
        <aside class="activity-bar">
          <div class="activity-top">
            <button
              class="activity-btn active"
              data-panel="explorer"
              title="Explorer (Ctrl+Shift+E)"
            >
              <i class="fas fa-copy"></i>
            </button>
            <button
              class="activity-btn"
              data-panel="templates"
              title="Templates"
            >
              <i class="fas fa-file-alt"></i>
            </button>
          </div>
          <div class="activity-bottom">
            <button class="activity-btn" id="distraction-free" title="Zen Mode">
              <i class="fas fa-expand"></i>
            </button>
          </div>
        </aside>

        <!-- ── Side Panel ── -->
        <aside class="side-panel" id="side-panel">
          <!-- Explorer -->
          <div class="panel-view active" id="panel-explorer">
            <div class="panel-header">
              <span class="panel-title">EXPLORER</span>
              <div class="panel-actions">
                <button
                  class="panel-btn"
                  id="new-btn-sidebar"
                  title="New Paper (Ctrl+N)"
                >
                  <i class="fas fa-plus"></i>
                </button>
                <button class="panel-btn" id="refresh-btn" title="Refresh">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button
                  class="panel-btn"
                  id="collapse-panel-btn"
                  title="Collapse (Ctrl+B)"
                >
                  <i class="fas fa-chevron-left"></i>
                </button>
              </div>
            </div>
            <div class="panel-section">
              <button class="section-toggle" data-section="papers">
                <i class="fas fa-chevron-down section-chevron"></i>
                <span>PAPERS</span>
                <span class="badge" id="paper-count">0</span>
              </button>
              <ul class="file-tree" id="paper-list"></ul>
            </div>
          </div>

          <!-- Templates -->
          <div class="panel-view" id="panel-templates">
            <div class="panel-header">
              <span class="panel-title">TEMPLATES</span>
            </div>
            <ul class="file-tree template-list">
              <li class="tree-item" data-template="basic">
                <i class="fas fa-file"></i> Basic Paper
              </li>
              <li class="tree-item" data-template="research">
                <i class="fas fa-flask"></i> Research Article
              </li>
              <li class="tree-item" data-template="literature">
                <i class="fas fa-book"></i> Literature Review
              </li>
              <li class="tree-item" data-template="notes">
                <i class="fas fa-sticky-note"></i> Quick Notes
              </li>
              <li class="tree-item" data-template="clinical">
                <i class="fas fa-user-md"></i> Clinical Case Study
              </li>
              <li class="tree-item" data-template="experiment">
                <i class="fas fa-vial"></i> Experiment Report
              </li>
              <li class="tree-item" data-template="summary">
                <i class="fas fa-list"></i> Paper Summary
              </li>
              <li class="tree-item" data-template="empty">
                <i class="fas fa-file-medical"></i> Empty Document
              </li>
            </ul>
          </div>
        </aside>

        <!-- ── Panel Resize Handle ── -->
        <div class="sash vertical" id="panel-sash"></div>

        <!-- ── Editor Group ── -->
        <main class="editor-group">
          <!-- Tab Bar -->
          <div class="tab-bar">
            <div class="tabs-scroll">
              <div class="editor-tab active" id="active-tab">
                <i class="fas fa-file-code tab-icon"></i>
                <span class="tab-name" id="tab-filename">Untitled</span>
                <span class="tab-dot" id="tab-unsaved"></span>
              </div>
            </div>
            <div class="tab-actions">
              <div class="view-toggle">
                <button data-view="split" class="active" title="Split View">
                  <i class="fas fa-columns"></i>
                </button>
                <button data-view="editor" title="Editor Only">
                  <i class="fas fa-code"></i>
                </button>
                <button data-view="preview" title="Preview Only">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <div class="dropdown">
                <button class="tab-action-btn" id="export-btn" title="Export">
                  <i class="fas fa-download"></i>
                </button>
                <div class="dropdown-menu" id="export-menu">
                  <button class="dropdown-option" data-export="markdown">
                    <i class="fas fa-file-code"></i> Markdown (.md)
                  </button>
                  <button class="dropdown-option" data-export="html">
                    <i class="fas fa-file-code"></i> HTML
                  </button>
                  <button class="dropdown-option" data-export="text">
                    <i class="fas fa-file-alt"></i> Plain Text
                  </button>
                  <div class="dropdown-divider"></div>
                  <button class="dropdown-option" data-export="pdf">
                    <i class="fas fa-file-pdf"></i> PDF (Print)
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Breadcrumb Bar -->
          <div class="breadcrumb-bar">
            <span class="crumb"><i class="fas fa-folder-open"></i> papers</span>
            <i class="fas fa-chevron-right crumb-sep"></i>
            <input
              type="text"
              id="filename"
              class="crumb-input"
              placeholder="my-paper.md"
            />
            <div class="breadcrumb-actions">
              <button class="crumb-btn" id="yaml-btn" title="Insert YAML">
                <i class="fas fa-code"></i> YAML
              </button>
              <div class="dropdown">
                <button
                  class="crumb-btn"
                  id="insert-btn"
                  title="Insert Snippet"
                >
                  <i class="fas fa-plus-circle"></i> Insert
                </button>
                <div class="dropdown-menu" id="insert-menu">
                  <button class="dropdown-option" data-insert="heading">
                    <i class="fas fa-heading"></i> Heading
                  </button>
                  <button class="dropdown-option" data-insert="link">
                    <i class="fas fa-link"></i> Link
                  </button>
                  <button class="dropdown-option" data-insert="image">
                    <i class="fas fa-image"></i> Image
                  </button>
                  <button class="dropdown-option" data-insert="list">
                    <i class="fas fa-list"></i> Bullet List
                  </button>
                  <button class="dropdown-option" data-insert="quote">
                    <i class="fas fa-quote-left"></i> Blockquote
                  </button>
                  <button class="dropdown-option" data-insert="math">
                    <i class="fas fa-square-root-alt"></i> Math Equation
                  </button>
                  <button class="dropdown-option" data-insert="table">
                    <i class="fas fa-table"></i> Table
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Format Bar -->
          <div class="quick-format">
            <button data-quick="**bold**" title="Bold (Ctrl+B)">
              <strong>B</strong>
            </button>
            <button data-quick="*italic*" title="Italic (Ctrl+I)">
              <em>I</em>
            </button>
            <span class="qf-sep"></span>
            <button data-quick="# " title="H1">H1</button>
            <button data-quick="## " title="H2">H2</button>
            <button data-quick="### " title="H3">H3</button>
            <span class="qf-sep"></span>
            <button data-quick="- " title="List">
              <i class="fas fa-list-ul"></i>
            </button>
            <button data-quick="1. " title="Num List">
              <i class="fas fa-list-ol"></i>
            </button>
            <button data-quick="[text](url)" title="Link">
              <i class="fas fa-link"></i>
            </button>
            <button data-quick="$equation$" title="Math">∑</button>
            <button data-quick="> " title="Quote">
              <i class="fas fa-quote-left"></i>
            </button>
            <button data-quick="---" title="HR">—</button>
          </div>

          <!-- Editor + Preview Split -->
          <div class="editor-content" id="editor-content">
            <button
              class="mobile-preview-toggle"
              id="mobile-preview-toggle"
              title="Toggle Preview"
            >
              <i class="fas fa-eye"></i>
            </button>

            <div class="editor-pane">
              <div class="pane-label"><i class="fas fa-code"></i> Markdown</div>

              <!-- Find & Replace Widget -->
              <div class="find-replace-widget" id="find-replace-widget">
                <div class="fr-row">
                  <input
                    type="text"
                    id="fr-find-input"
                    class="fr-input"
                    placeholder="Find"
                    spellcheck="false"
                  />
                  <button
                    class="fr-btn"
                    id="fr-regex-btn"
                    title="Use Regular Expression"
                  >
                    .*
                  </button>
                  <button class="fr-btn" id="fr-case-btn" title="Match Case">
                    Aa
                  </button>
                  <span class="fr-count" id="fr-count">0 results</span>
                  <button
                    class="fr-btn"
                    id="fr-prev-btn"
                    title="Previous (Shift+Enter)"
                  >
                    <i class="fas fa-chevron-up"></i>
                  </button>
                  <button class="fr-btn" id="fr-next-btn" title="Next (Enter)">
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <button
                    class="fr-btn"
                    id="fr-expand-btn"
                    title="Toggle Replace"
                  >
                    <i class="fas fa-chevron-down"></i>
                  </button>
                  <button
                    class="fr-btn fr-close"
                    id="fr-close-btn"
                    title="Close (Esc)"
                  >
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="fr-row fr-replace-row" id="fr-replace-row">
                  <input
                    type="text"
                    id="fr-replace-input"
                    class="fr-input"
                    placeholder="Replace"
                    spellcheck="false"
                  />
                  <button class="fr-btn" id="fr-replace-btn" title="Replace">
                    <i class="fas fa-exchange-alt"></i>
                  </button>
                  <button
                    class="fr-btn"
                    id="fr-replace-all-btn"
                    title="Replace All"
                  >
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
              </div>

              <div class="editor-scroll">
                <div class="line-numbers" id="line-numbers"></div>
                <div class="editor-input-wrap">
                  <pre
                    class="syntax-highlight"
                    id="syntax-highlight"
                    aria-hidden="true"
                  ><code></code></pre>
                  <textarea
                    id="markdown-editor"
                    placeholder="Start writing your paper in Markdown...

# Paper Title

*Author Name — Month Year*

## Abstract

Write your abstract here…"
                    spellcheck="false"
                  ></textarea>
                </div>
              </div>
            </div>

            <div class="split-sash" id="editor-sash"></div>

            <div class="preview-pane">
              <div class="pane-label"><i class="fas fa-eye"></i> Preview</div>
              <div class="preview-content" id="preview-content">
                <div class="empty-state">
                  <i class="fas fa-file-alt"></i>
                  <h3>Live Preview</h3>
                  <p>Start typing to see your formatted paper</p>
                  <div class="shortcuts-hint">
                    <kbd>Ctrl</kbd>+<kbd>S</kbd> Save &nbsp;
                    <kbd>Ctrl</kbd>+<kbd>B</kbd> Bold &nbsp;
                    <kbd>Ctrl</kbd>+<kbd>I</kbd> Italic
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- Zen Mode Toolbar (floats independently — must be outside status-bar) -->
      <div class="zen-toolbar" id="zen-toolbar">
        <button data-zen-view="split" class="active" title="Split View">
          <i class="fas fa-columns"></i>
        </button>
        <button data-zen-view="editor" title="Editor Only">
          <i class="fas fa-code"></i>
        </button>
        <button data-zen-view="preview" title="Preview Only">
          <i class="fas fa-eye"></i>
        </button>
        <button id="zen-exit" title="Exit Zen Mode (Esc)">
          <i class="fas fa-compress"></i>
        </button>
      </div>

      <!-- ── Status Bar ── -->
      <footer class="status-bar">
        <div class="status-left">
          <button
            class="status-item clickable"
            id="sidebar-toggle"
            title="Toggle Sidebar (Ctrl+B)"
          >
            <i class="fas fa-columns"></i>
          </button>
          <div class="status-item" id="autosave-indicator">
            <i class="fas fa-circle"></i> <span>Ready</span>
          </div>
          <div class="status-item">
            <i class="fas fa-code-branch"></i> papers
          </div>
        </div>
        <div class="status-right">
          <div class="status-item" id="cursor-position">Ln 1, Col 1</div>
          <div class="status-item" id="word-count">
            <span id="wc-words">0</span> words &nbsp;
            <span id="wc-chars">0</span> chars
          </div>
          <div class="status-item">Markdown</div>
          <div class="status-item">UTF-8</div>
          <button
            class="status-item clickable"
            id="font-decrease"
            title="Ctrl+-"
          >
            <i class="fas fa-minus"></i>
          </button>
          <span class="status-item" id="font-size-label">14px</span>
          <button
            class="status-item clickable"
            id="font-increase"
            title="Ctrl++"
          >
            <i class="fas fa-plus"></i>
          </button>
          <button
            class="status-item save-status clickable"
            id="save-btn"
            title="Save (Ctrl+S)"
          >
            <i class="fas fa-save"></i> Save
          </button>
        </div>
      </footer>

      <!-- Toast -->
      <div class="toast" id="toast"></div>

      <!-- Command Palette -->
      <div class="command-palette-overlay" id="command-palette">
        <div class="command-palette">
          <div class="command-input-wrap">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="command-palette-input"
              placeholder="Type a paper name or command…"
            />
          </div>
          <ul class="command-results" id="command-list"></ul>
        </div>
      </div>

      <!-- Delete Modal -->
      <div class="modal-overlay" id="delete-modal">
        <div class="modal">
          <h3>
            <i
              class="fas fa-exclamation-triangle"
              style="color: var(--danger)"
            ></i>
            Delete Paper?
          </h3>
          <p>
            Are you sure you want to delete "<span id="delete-filename"></span
            >"? This cannot be undone.
          </p>
          <div class="modal-actions">
            <button class="btn btn-secondary" id="cancel-delete">Cancel</button>
            <button class="btn btn-danger" id="confirm-delete">Delete</button>
          </div>
        </div>
      </div>

      <!-- Shortcuts Modal -->
      <div class="modal-overlay" id="shortcuts-modal">
        <div class="modal shortcuts-modal">
          <h3>
            <i class="fas fa-keyboard" style="color: var(--accent)"></i>
            Keyboard Shortcuts
          </h3>
          <div class="shortcuts-grid">
            <div class="shortcut-group">
              <h4>General</h4>
              <div><kbd>Ctrl</kbd>+<kbd>S</kbd> Save</div>
              <div><kbd>Ctrl</kbd>+<kbd>N</kbd> New Paper</div>
              <div><kbd>Ctrl</kbd>+<kbd>P</kbd> Command Palette</div>
              <div><kbd>Ctrl</kbd>+<kbd>B</kbd> Toggle Sidebar</div>
              <div><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>T</kbd> Theme</div>
              <div><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>E</kbd> Explorer</div>
              <div><kbd>F11</kbd> Zen Mode</div>
              <div><kbd>Ctrl</kbd>+<kbd>/</kbd> This dialog</div>
            </div>
            <div class="shortcut-group">
              <h4>Editing</h4>
              <div><kbd>Ctrl</kbd>+<kbd>B</kbd> Bold (in editor)</div>
              <div><kbd>Ctrl</kbd>+<kbd>I</kbd> Italic</div>
              <div><kbd>Ctrl</kbd>+<kbd>K</kbd> Insert Link</div>
              <div><kbd>Ctrl</kbd>+<kbd>D</kbd> Duplicate Line</div>
              <div><kbd>Ctrl</kbd>+<kbd>F</kbd> Find</div>
              <div><kbd>Ctrl</kbd>+<kbd>H</kbd> Find & Replace</div>
              <div><kbd>Tab</kbd> Indent</div>
              <div><kbd>Shift</kbd>+<kbd>Tab</kbd> Dedent</div>
              <div><kbd>Ctrl</kbd>+<kbd>+</kbd> Bigger Font</div>
              <div><kbd>Ctrl</kbd>+<kbd>-</kbd> Smaller Font</div>
              <div><kbd>/</kbd> Slash commands</div>
              <div><kbd>Esc</kbd> Close Modals</div>
            </div>
          </div>
          <div class="modal-actions">
            <button class="btn btn-secondary" id="close-shortcuts">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/admin/backup-login.js"></script>
    <script src="/admin/admin.js"></script>
  </body>
</html>
